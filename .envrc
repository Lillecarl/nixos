#! /usr/bin/env bash

# We need $FLAKE for our impurity
export FLAKE=$PWD
# Save $FLAKE to a file
echo "\"$FLAKE\"" > "$FLAKE/.flakepath"
# Create profile directory
mkdir -p "$PWD/.nix"

# Cache PATH from nix develop for one hour
if ! fd --type f --hidden --quiet --changed-within 1h .nixpath
then
  # shellcheck disable=2016
  nix develop --profile "$PWD/.nix/profile" -c sh -c 'echo $PATH' > .nixpath
else
	echo "Using cached Nix PATH"
fi

PATH_add "$(cat .nixpath)"
PATH_add "$FLAKE/bin"
